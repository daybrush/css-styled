{"version":3,"file":"styled.js","sources":["../src/utils.ts","../src/styled.ts"],"sourcesContent":["import stringHash from \"string-hash\";\nimport { splitComma } from \"@daybrush/utils\";\nimport { InjectOptions } from \"./types\";\n\nexport function getHash(str: string) {\n    return stringHash(str).toString(36);\n}\nexport function getShadowRoot(parentElement: HTMLElement | SVGElement) {\n    if (parentElement && parentElement.getRootNode) {\n        const rootNode = parentElement.getRootNode();\n\n        if (rootNode.nodeType === 11) {\n            return rootNode;\n        }\n    }\n    return;\n}\nexport function injectStyle(className: string, css: string, options: Partial<InjectOptions>, shadowRoot?: Node) {\n    const style = document.createElement(\"style\");\n\n    style.setAttribute(\"type\", \"text/css\");\n    style.setAttribute(\"data-styled-id\", className);\n\n    if (options.nonce) {\n        style.setAttribute(\"nonce\", options.nonce);\n    }\n    let styleCSS = css;\n    if (!options.original) {\n        styleCSS = css.replace(/([^}{]*){/mg, (all, selector) => {\n            return splitComma(selector).map(subSelector => {\n                if (subSelector.indexOf(\":global\") > -1) {\n                    return subSelector.replace(/\\:global/g, \"\");\n                } else if (subSelector.indexOf(\":host\") > -1) {\n                    return `${subSelector.replace(/\\:host/g, `.${className}`)}`;\n                }\n                return `.${className} ${subSelector}`;\n            }).join(\", \") + \"{\";\n        });\n    }\n    style.innerHTML = styleCSS;\n\n    (shadowRoot || document.head || document.body).appendChild(style);\n    return style;\n}\n","import { getHash, injectStyle, getShadowRoot } from \"./utils\";\nimport { StyledInjector, InjectOptions } from \"./types\";\n\nexport default function styled(css: string): StyledInjector {\n    const injectClassName = \"rCS\" + getHash(css);\n    let injectCount = 0;\n    let injectElement!: HTMLStyleElement;\n\n    return {\n        className: injectClassName,\n        inject(el: HTMLElement | SVGElement, options: Partial<InjectOptions> = {}) {\n            const shadowRoot = getShadowRoot(el);\n            const firstMount = injectCount === 0;\n            let styleElement: HTMLStyleElement;\n\n            if (shadowRoot || firstMount) {\n                styleElement = injectStyle(injectClassName, css, options, shadowRoot);\n            }\n            if (firstMount) {\n                injectElement = styleElement;\n            }\n            if (!shadowRoot) {\n                ++injectCount;\n            }\n            return {\n                destroy() {\n                    if (shadowRoot) {\n                        el.removeChild(styleElement);\n                        styleElement = null;\n                    } else {\n                        if (injectCount > 0) {\n                            --injectCount;\n                        }\n                        if (injectCount === 0 && injectElement) {\n                            injectElement.parentNode!.removeChild(injectElement);\n                            injectElement = null;\n                        }\n                    }\n                },\n            };\n        },\n    };\n}\n\nexport * from \"./types\";\n"],"names":["getHash","str","stringHash","toString","getShadowRoot","parentElement","getRootNode","rootNode","nodeType","injectStyle","className","css","options","shadowRoot","style","document","createElement","setAttribute","nonce","styleCSS","original","replace","all","selector","splitComma","map","subSelector","indexOf","join","innerHTML","head","body","appendChild","styled","injectClassName","injectCount","injectElement","inject","el","firstMount","styleElement","destroy","removeChild","parentNode"],"mappings":"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"}